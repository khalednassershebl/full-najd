<?php

namespace Database\Seeders;

use App\Models\Product;
use App\Models\ProductCategory;
use Illuminate\Database\Seeder;

class ProductSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        $categories = ProductCategory::orderBy('sort_order')->get();
        if ($categories->isEmpty()) {
            $this->command->warn('Run ProductCategorySeeder first.');
            return;
        }

        $categoryBySlug = $categories->keyBy('slug');

        $products = [
            [
                'title' => 'نظام إدارة المستشفيات',
                'excerpt' => 'نظام متكامل لإدارة المستشفيات والعيادات الطبية يتضمن إدارة المواعيد والمرضى والسجلات الطبية.',
                'content' => '<p>نظام إدارة مستشفيات وعيادات يغطي الحجوزات والملفات الطبية والمخزون والصيدلية والتقارير. يدعم التكامل مع الأجهزة الطبية ويسهل متابعة المرضى من الاستقبال حتى الخروج.</p><h2>المميزات</h2><p>إدارة المواعيد، السجلات الطبية الإلكترونية، الفواتير، المخزون، التقارير الإدارية.</p>',
                'category_slug' => 'medical',
                'demo_url' => null,
                'sort_order' => 1,
            ],
            [
                'title' => 'تطبيق الصيدلية الذكية',
                'excerpt' => 'تطبيق ذكي لإدارة الصيدليات يتيح تتبع المخزون وإدارة الوصفات الطبية وتقديم الاستشارات الدوائية.',
                'content' => '<p>تطبيق لإدارة الصيدليات: تتبع المخزون، تنبيهات انتهاء الصلاحية، إدارة الوصفات، والاستشارات الدوائية. يدعم الباركود والفواتير الإلكترونية.</p>',
                'category_slug' => 'medical',
                'demo_url' => null,
                'sort_order' => 2,
            ],
            [
                'title' => 'منصة الاستشارات الطبية عن بُعد',
                'excerpt' => 'منصة متكاملة للاستشارات الطبية عن بُعد تتيح للمرضى التواصل مع الأطباء والحصول على الاستشارات الطبية.',
                'content' => '<p>منصة للاستشارات الطبية عن بُعد: حجز المواعيد، الفيديو، وصف الأدوية، والمتابعة. مناسبة للعيادات والمراكز الطبية التي تقدم خدمة الاستشارات أونلاين.</p>',
                'category_slug' => 'medical',
                'demo_url' => null,
                'sort_order' => 3,
            ],
            [
                'title' => 'نظام إدارة المدارس',
                'excerpt' => 'نظام شامل لإدارة المدارس يتضمن إدارة الطلاب والمعلمين والجداول الدراسية والامتحانات والنتائج.',
                'content' => '<p>نظام إدارة مدارس: تسجيل الطلاب، الجداول، الحضور والغياب، الامتحانات والنتائج، التواصل مع أولياء الأمور، والتقارير الإدارية.</p>',
                'category_slug' => 'educational',
                'demo_url' => null,
                'sort_order' => 4,
            ],
            [
                'title' => 'منصة التعلم الإلكتروني',
                'excerpt' => 'منصة متكاملة للتعلم الإلكتروني تتيح للمؤسسات التعليمية تقديم الدورات والدروس التفاعلية عبر الإنترنت.',
                'content' => '<p>منصة تعلم إلكتروني: إنشاء الدورات، الفيديوهات والاختبارات، الشهادات، ومتابعة التقدم. مناسبة للجامعات والمعاهد والتدريب.</p>',
                'category_slug' => 'educational',
                'demo_url' => null,
                'sort_order' => 5,
            ],
            [
                'title' => 'تطبيق إدارة الجامعات',
                'excerpt' => 'تطبيق شامل لإدارة الجامعات يتضمن التسجيل الإلكتروني وإدارة الكليات والبرامج الأكاديمية.',
                'content' => '<p>تطبيق إدارة جامعات: القبول الإلكتروني، الخطط الدراسية، الشهادات، البحث العلمي، وخدمات الطلاب وأعضاء الهيئة التدريسية.</p>',
                'category_slug' => 'educational',
                'demo_url' => null,
                'sort_order' => 6,
            ],
            [
                'title' => 'نظام إدارة المتاجر الإلكترونية',
                'excerpt' => 'نظام متكامل لإدارة المتاجر الإلكترونية يتضمن إدارة المنتجات والطلبات والمخزون والدفع الإلكتروني.',
                'content' => '<p>نظام متجر إلكتروني: المنتجات، التصنيفات، الطلبات، المخزون، طرق الدفع والشحن، والعروض. جاهز للتكامل مع بوابات الدفع.</p>',
                'category_slug' => 'commercial',
                'demo_url' => null,
                'sort_order' => 7,
            ],
            [
                'title' => 'نظام إدارة المطاعم',
                'excerpt' => 'نظام شامل لإدارة المطاعم يتضمن إدارة الطلبات والموائد والموظفين والمخزون والمبيعات.',
                'content' => '<p>نظام إدارة مطاعم: القوائم، الطلبات، الطاولات، المطبخ، المحاسبة، والتقارير. يدعم الطلبات من الطاولة أو التيك أواي.</p>',
                'category_slug' => 'commercial',
                'demo_url' => null,
                'sort_order' => 8,
            ],
            [
                'title' => 'منصة الخدمات الحكومية الإلكترونية',
                'excerpt' => 'منصة متكاملة لتقديم الخدمات الحكومية إلكترونياً تتيح للمواطنين إتمام المعاملات بسهولة وسرعة.',
                'content' => '<p>منصة خدمات حكومية إلكترونية: تقديم الطلبات، المتابعة، الدفع الإلكتروني، والمواعيد. تتوافق مع معايير الحكومة الإلكترونية والأمان.</p>',
                'category_slug' => 'government',
                'demo_url' => null,
                'sort_order' => 9,
            ],
            [
                'title' => 'نظام إدارة المصانع',
                'excerpt' => 'نظام متكامل لإدارة المصانع يتضمن إدارة الإنتاج والجودة والمخزون والصيانة والموارد البشرية.',
                'content' => '<p>نظام إدارة مصانع: خطط الإنتاج، الجودة، المخزون، الصيانة، والموارد البشرية. يدعم التكامل مع الآلات ونظم التخطيط.</p>',
                'category_slug' => 'industrial',
                'demo_url' => null,
                'sort_order' => 10,
            ],
        ];

        foreach ($products as $data) {
            $categorySlug = $data['category_slug'] ?? null;
            unset($data['category_slug']);

            $categoryId = $categorySlug && isset($categoryBySlug[$categorySlug])
                ? $categoryBySlug[$categorySlug]->id
                : null;

            Product::firstOrCreate(
                ['slug' => \Illuminate\Support\Str::slug($data['title'])],
                array_merge($data, [
                    'category_id' => $categoryId,
                    'image' => null,
                    'is_published' => true,
                ])
            );
        }
    }
}
